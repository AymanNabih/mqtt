/**
 *
 */
package org.eclipsescout.mqttclient.client.services;

import org.eclipse.scout.commons.exception.ProcessingException;
import org.eclipse.scout.commons.prefs.UserPreferences;
import org.eclipse.scout.rt.shared.TEXTS;
import org.eclipse.scout.service.AbstractService;
import org.osgi.service.prefs.BackingStoreException;

/**
 * Handles reading and saving of user preferences at startup and shutdown of application.
 * On windows, the preferences are written into "C:\\Documents and Settings\\<USER>\\user\\.settings"
 *
 * @author mzi
 */
public class UserPreferencesService extends AbstractService implements IUserPreferencesService {
  private final String PREF_DOMAIN = "ScoutMqttClient";

  private final String PREF_BROKER_URL = "PREF_BROKER_URL";
  private final String PREF_CLIENT_ID = "PREF_CLIENT_ID";
  private final String PREF_USER_NAME = "PREF_USER_NAME";
  private final String PREF_PASSWORD = "PREF_PASSWORD";
  private final String PREF_CONNECTION_TIMEOUT = "PREF_CONNECTION_TIMEOUT";
  private final String PREF_CLEAN_SESSION = "PREF_CLEAN_SESSION";
  private final String PREF_WILL_TOPIC = "PREF_WILL_TOPIC";
  private final String PREF_WILL_MESSAGE = "PREF_WILL_MESSAGE";
  private final String PREF_WILL_QOS = "PREF_WILL_QOS";
  private final String PREF_WILL_RETAINED = "PREF_WILL_RETAINED";
  private final String PREF_DEFAULT_TOPIC = "PREF_DEFAULT_TOPIC";
  private final String PREF_DEFAULT_QOS = "PREF_DEFAULT_QOS";
  private final String PREF_DEFAULT_RETAINED = "PREF_DEFAULT_RETAINED";

  private UserPreferences m_pref = null;

  public UserPreferencesService() {
    super();
    m_pref = new UserPreferences(PREF_DOMAIN);
  }

  @Override
  public void load() throws ProcessingException {
    m_pref.create();
  }

  @SuppressWarnings("restriction")
  @Override
  public void store() throws ProcessingException {
    try {
      m_pref.flush();
    }
    catch (BackingStoreException e) {
      throw new ProcessingException(TEXTS.get("PrefFlushFailed"), e);
    }
  }

  @SuppressWarnings("restriction")
  @Override
  public void setBrokerUrl(String url) throws ProcessingException {
    m_pref.put(PREF_BROKER_URL, url);
  }

  @SuppressWarnings("restriction")
  @Override
  public String getBrokerUrl() throws ProcessingException {
    return m_pref.get(PREF_BROKER_URL, null);
  }

  @SuppressWarnings("restriction")
  @Override
  public void setClientId(String id) throws ProcessingException {
    m_pref.put(PREF_CLIENT_ID, id);
  }

  @SuppressWarnings("restriction")
  @Override
  public String getClientId() throws ProcessingException {
    return m_pref.get(PREF_CLIENT_ID, null);
  }

}
